<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.3.3" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>SEB 3.5.0 on Linux (VM Bypass): OcttKB ‚Äî Octt Knowledge Base || (Start at ‚û°Ô∏è [OcttKB] üìåÔ∏è)</title>
</head>
<body class="tc-body">
<p><div style="-padding-left:16px;-padding-right:16px;">
<h1 class="tc-site-title">
<a class="tc-tiddlylink tc-tiddlylink-resolves" href="OcttKB.html">OcttKB</a>
</h1>
<div class="tc-site-subtitle">
Octt Knowledge Base || Powered by <a class="tc-tiddlylink tc-tiddlylink-resolves" href="TiddlyWiki.html">TiddlyWiki</a>.</div>
<p>
<b>Note</b>: You're viewing the no-JS version of this site, some features will be missing. For the best experience, <a href="./">load the full version</a>.
</p>
</div></p><p><div>
<a class="tc-tiddlylink tc-tiddlylink-resolves StartHere-Button" href="OcttKB.html"><img class=" tc-image-loading" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAAcBAMAAAAgvKpJAAAAG1BMVEVHcEzAwMAAAADf39+AgID/AAAAAP8A/wD//wBHfaDsAAAAAXRSTlMAQObYZgAAAKlJREFUKM/Vks0NwyAMhVnBVvA5flJ+rlU7QidAygIcOkBHyOQ1oDRNRbjnYQmhz9jmCXdv6dG7GzXUXYcDTQ7UEgpnC4QJapvWODOGML2VkFcW616f8eVU4d5OA7Bx5RSMnXsf0nylf85h/a3vl4A459lSf2t34GL1xzivG8fffRGJhaPKSV5xBNbS31CqTzj6k+c78c/8QXrYmf9cvNcr/q9nU71DU+4Dt0ZXoKPvmm4AAAAASUVORK5CYII="> <span>here!</span></a>
</div></p>
<section class="tc-story-river tc-static-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists  tc-tagged-ToDo tc-tagged-Virtual%20Machine" data-tags="ToDo [[Virtual Machine]]" data-tiddler-title="SEB 3.5.0 on Linux (VM Bypass)" role="article">







  
  <div class="gk0wk-notionpagebg gk0wk-notionpagebg-n">
    <div class="gk0wk-notionbg-addbuttons">
      <button class="" title="Add Icon">üòÅ Add Icon</button>
      <button class="" title="Add Cover"><svg class="tc-image-picture tc-image-button" height="22pt" viewBox="0 0 128 128" width="22pt"><path d="M112 68.233v-48.23A4.001 4.001 0 00107.997 16H20.003A4.001 4.001 0 0016 20.003v38.31l9.241-14.593c2.8-4.422 9.023-5.008 12.6-1.186l18.247 20.613 13.687-6.407a8 8 0 018.903 1.492 264.97 264.97 0 002.92 2.739 249.44 249.44 0 006.798 6.066 166.5 166.5 0 002.106 1.778c2.108 1.747 3.967 3.188 5.482 4.237.748.518 1.383.92 2.044 1.33.444.117 1.046.144 1.809.05 1.873-.233 4.238-1.144 6.723-2.547a36.016 36.016 0 003.205-2.044c.558-.4.93-.686 1.07-.802.376-.31.765-.577 1.165-.806zM0 8.007A8.01 8.01 0 018.007 0h111.986A8.01 8.01 0 01128 8.007v111.986a8.01 8.01 0 01-8.007 8.007H8.007A8.01 8.01 0 010 119.993V8.007zM95 42a8 8 0 100-16 8 8 0 000 16zM32 76c15.859 4.83 20.035 7.244 20.035 12S32 95.471 32 102.347c0 6.876 1.285 4.99 1.285 9.653H68s-13.685-6.625-13.685-10.8c0-7.665 10.615-8.34 10.615-13.2 0-7.357-14.078-8.833-32.93-12z" fill-rule="evenodd"></path></svg> Add Cover</button>
    </div>
  </div>










<div class="tc-tiddler-title"><div class="tc-titlebar"><span class="View-Breadcrumbs"><span class="Path-Elem" data-path-elem="SEB 3.5.0 on Linux (VM Bypass)"><details><summary>SEB 3.5.0 on Linux (VM Bypass)</summary><div class="tc-table-of-contents"><ol class="tc-toc toc-selective-expandable"><div class="tc-tree"><div><ol></ol></div></div></ol></div></details></span><a class="Path-Copy" href="javascript:(navigator.clipboard.writeText(&quot;SEB 3.5.0 on Linux (VM Bypass)&quot;))" title="Copy path to Clipboard">‚ñ™Ô∏è</a></span><span class="tc-tiddler-controls"><button aria-label="this tiddler is stored in browser storage" class="tc-btn-invisible tc-btn-%24%3A%2Fplugins%2Fbtheado%2FBrowserStorage%2FButtons%2Fbrowser-storage-info" title="this tiddler is stored in browser storage"><svg class="tc-image-bxi-bx-cylinder tc-image-button" height="22pt" viewBox="0 0 24 24" width="22pt"><path d="M12,22c5.131,0,9-1.935,9-4.5V7h-0.053C20.98,6.836,21,6.67,21,6.5C21,3.935,17.131,2,12,2C7.209,2,3.52,3.688,3.053,6H3 v11.5C3,20.065,6.869,22,12,22z M12,20c-4.273,0-7-1.48-7-2.5V9.394C6.623,10.387,9.111,11,12,11s5.377-0.613,7-1.606V17.5 C19,18.52,16.273,20,12,20z M12,4c4.273,0,7,1.48,7,2.5S16.273,9,12,9S5,7.52,5,6.5S7.727,4,12,4z"></path></svg></button><button aria-expanded="false" aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div><span class=" tc-reveal"><button aria-label="fold tiddler" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Ffold" title="Fold the body of this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span><h2 class="tc-title">SEB 3.5.0 on Linux (VM Bypass)</h2></span></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class="tc-reveal"></div><div class=" tc-reveal"><div class="tc-subtitle"><a class="tc-tiddlylink tc-tiddlylink-resolves" href="Octt.html">Octt</a>¬†13th June 2023 at 12:59pm</div></div><div class=" tc-reveal"><div class="tc-tags-wrapper"><span class="tc-tag-list-item" data-tag-title="ToDo"><span aria-expanded="false" class="tc-tag-label tc-btn-invisible" draggable="true" style="fill:#333353;color:#333353;">ToDo</span><span class="tc-drop-down tc-reveal" hidden="true"></span></span><span class="tc-tag-list-item" data-tag-title="Virtual Machine"><span aria-expanded="false" class="tc-tag-label tc-btn-invisible" draggable="true" style="fill:#333353;color:#333353;">Virtual Machine</span><span class="tc-drop-down tc-reveal" hidden="true"></span></span></div></div><div class="OcttKB-i18n" style="font-size:initial;">
  


</div><div class="tc-tiddler-body tc-reveal"><p>Having the need of running Safe Exam Browser while I've only got GNU+Linux on my laptop and desktop, I had to look for alternative solutions.</p><ul><li>There is no linux-native full SEB application, it's only for Windows and macOS.</li><li>Running SEB on WinPE is unfeasible as it needs to install many runtime dependencies, it's too slow to do that while booted into the live system, and on my 4 GB laptop the ramdisk is not big enough.</li><li>SEB by default detects and blocks virtual machines.<ul><li>This option can be changed in the local configuration file, but when starting an exam the configuration loaded from the server takes precedence over the local one.</li><li>SEB 3.5.0 added an hard-to-break anti-tampering mechanism, where the LMS server verifies if the client is altered and won't let you take exams; patching the few needed modules won't work.</li></ul></li></ul><p>Turns out only way to work around the issue is to make a relatively stealth VM.</p><p>By analyzing the SEB for Windows source code, we can see some important files and methods, both by searching the files for keywords and by opening files referenced by other ones:</p><ul><li><a class="tc-tiddlylink-external" href="https://github.com/SafeExamBrowser/seb-win-refactoring/blob/11b10e8e4524c1fe65b6c3db7d12e172facf322c/SafeExamBrowser.SystemComponents/VirtualMachineDetector.cs#L49" rel="noopener noreferrer" target="_blank">VirtualMachineDetector.cs:IsVirtualMachine()</a>: Clearly the main place where VM detection is happening.<ul><li><a class="tc-tiddlylink-external" href="https://github.com/SafeExamBrowser/seb-win-refactoring/blob/11b10e8e4524c1fe65b6c3db7d12e172facf322c/SafeExamBrowser.SystemComponents/SystemInfo.cs" rel="noopener noreferrer" target="_blank">SystemInfo.cs</a>: Contains WMI calls for retrieval of multiple base system and peripheral informations.</li></ul></li></ul><p>Also, by referring to various strings in the source code and <a class="tc-tiddlylink-external" href="https://github.com/SafeExamBrowser/seb-win-refactoring/issues/268#issuecomment-994586854" rel="noopener noreferrer" target="_blank">issue #268</a>, we can see that in VMs a bug occurs where 0 displays are detected. This must be accounted for after succeeding in concealing the VM from the program. A good start is in this class and method, which checks for displays and throws errors if necessary:</p><ul><li><a class="tc-tiddlylink-external" href="https://github.com/SafeExamBrowser/seb-win-refactoring/blob/11b10e8e4524c1fe65b6c3db7d12e172facf322c/SafeExamBrowser.Runtime/Operations/DisplayMonitorOperation.cs#L51" rel="noopener noreferrer" target="_blank">DisplayMonitorOperation.cs:CheckDisplayConfiguration()</a>: Main runtime checking for correct display configuration.<ul><li><a class="tc-tiddlylink-external" href="https://github.com/SafeExamBrowser/seb-win-refactoring/blob/11b10e8e4524c1fe65b6c3db7d12e172facf322c/SafeExamBrowser.Monitoring/Display/DisplayMonitor.cs#L156" rel="noopener noreferrer" target="_blank">DisplayMonitor.cs:TryLoadDisplays()</a>: Contains WMI calls for checking displays.</li></ul></li></ul><p>[TODO]</p><h2 class="">VM Setup</h2><p>We choose VMWare Workstation 17 (latest version) as it lets a few important options be customized. First I created a VM with close-to-suggested settings (the primary ones don't matter here).</p><p>Then I modified the network card settings... [TODO]</p><p>After this, I installed Windows 10 (a build from 2019 I have on a burned DVD always at hand). No VMWare tools have been installed (see below).</p><h2 class="">Hardening Windows</h2><p>In this case "hardening" is meant as enhancing the privacy of our Windows against third-party apps, which we need to evade VM detection; we don't mean it as making the system more secure or robust for an exam purpose, which is something neutral to us (we as examinees don't care about it, it does neither benefit nor harm us).</p><p>Create two new text files wherever you want. I will name them as <code>WMI.mof</code> and <code>CIMv2.mof</code> for convenience.</p><p>Copy-paste in <code>WMI.mof</code>:</p><pre><code>#pragma namespace ("\\\\.\\root\\WMI")

class WmiMonitorBasicDisplayParams
{
	boolean Active;
	uint8 DisplayTransferCharacteristic;
	[key] string InstanceName;
	uint8 MaxHorizontalImageSize;
	uint8 MaxVerticalImageSize;
	SupportedDisplayFeaturesDescriptor SupportedDisplayFeatures;
	uint8 VideoInputType;
};

[DYNPROPS]
instance of WmiMonitorBasicDisplayParams
{
	Active = TRUE;
	InstanceName = "DISPLAY\\Default_Monitor\\4&amp;427137e&amp;0&amp;UID0_0";
};

class WmiMonitorConnectionParams
{
	boolean Active;
	[key] string InstanceName;
	uint32 VideoOutputTechnology;
};

[DYNPROPS]
instance of WmiMonitorConnectionParams
{
	Active = TRUE;
	InstanceName = "DISPLAY\\Default_Monitor\\4&amp;427137e&amp;0&amp;UID0_0";
	VideoOutputTechnology = 2147483648;
};</code></pre><p>Copy-paste in <code>CIMv2.mof</code>:</p><pre><code>#pragma namespace ("\\\\.\\root\\CIMv2")

/* PS C:&gt; get-wmiobject -class Win32_BIOS */
class Win32_BIOS
{
	[key] string SMBIOSBIOSVersion;
	string Manufacturer;
	string SerialNumber;
	string Name;
	uint16 BiosCharacteristics[];
	string Version;
};

[DYNPROPS]
instance of Win32_BIOS
{
	SMBIOSBIOSVersion = "6.0";
	Manufacturer = "Phoenix Technologies LTD";
	SerialNumber = "a1 7b 88 e5 6c 44 73 8e-24 16 1d e6 69 59 83 a1";
	Name = "PhoenixBIOSS 5.0 Release 6.0";
	BiosCharacteristics = {1,2,3};
	Version = "INTEL - 6040001";
};

/* PS C:&gt; get-wmiobject -class Win32_ComputerSystem */
class Win32_ComputerSystem
{
	[key] string Name;
	string Domain;
	string Manufacturer;
	string Model;
	string OEMStringArray[];
};

[DYNPROPS]
instance of Win32_ComputerSystem
{
	Name = "WIN10";
	Domain = "WORKGROUP";
	Manufacturer = "Acer";
	Model = "Acer Computer";
	OEMStringArray = {"Acer Computer"};
};

class Win32_DiskDrive
{
	uint16 Availability;
	uint32 BytesPerSector;
	uint16 Capabilities[];
	string CapabilityDescriptions[];
	string Caption;
	string CompressionMethod;
	uint32 ConfigManagerErrorCode;
	boolean ConfigManagerUserConfig;
	string CreationClassName;
	uint64 DefaultBlockSize;
	string Description;
	string DeviceID;
	boolean ErrorCleared;
	string ErrorDescription;
	string ErrorMethodology;
	string FirmwareRevision;
	uint32 Index;
	datetime InstallDate;
	string InterfaceType;
	uint32 LastErrorCode;
	string Manufacturer;
	uint64 MaxBlockSize;
	uint64 MaxMediaSize;
	boolean MediaLoaded;
	string MediaType;
	uint64 MinBlockSize;
	string Model;
	string Name;
	boolean NeedsCleaning;
	uint32 NumberOfMediaSupported;
	uint32 Partitions;
	[key] string PNPDeviceID;
	uint16 PowerManagementCapabilities[];
	boolean PowerManagementSupported;
	uint32 SCSIBus;
	uint16 SCSILogicalUnit;
	uint16 SCSIPort;
	uint16 SCSITargetId;
	uint32 SectorsPerTrack;
	string SerialNumber;
	uint32 Signature;
	uint64 Size;
	string Status;
	uint16 StatusInfo;
	string SystemCreationClassName;
	string SystemName;
	uint64 TotalCylinders;
	uint32 TotalHeads;
	uint64 TotalSectors;
	uint64 TotalTracks;
	uint32 TracksPerCylinder;
};

[DYNPROPS]
instance of Win32_DiskDrive
{
	SerialNumber = "Crucial SSD";
	PNPDeviceID = "SCSI\\DISK&amp;VEN_NVME&amp;PROD_CRUCIAL_N\\5&amp;25A13950&amp;0&amp;000000";
};

class Win32_PnPEntity : CIM_LogicalDevice
{
	[Read : ToSubclass,Key : ToInstance ToSubclass DisableOverride,Override("DeviceId") : ToSubclass,MappingStrings{"WMI"} : ToSubclass] string DeviceID;
	[read : ToSubclass] string HardwareID[];
	[read : ToSubclass] string CompatibleID[];
	[read : ToSubclass,MappingStrings{"WMI"} : ToSubclass] string Manufacturer;
	[read : ToSubclass,MappingStrings{"WMI"} : ToSubclass] string Service;
	[read : ToSubclass,MappingStrings{"WMI"} : ToSubclass] string PNPClass;
	[read : ToSubclass,MappingStrings{"WMI"} : ToSubclass] string ClassGuid;
	[read : ToSubclass,MappingStrings{"WMI"} : ToSubclass] boolean Present;
	[Implemented] Uint32 Enable([OUT] boolean rebootNeeded);
	[Implemented] Uint32 Disable([OUT] boolean rebootNeeded);
	[Implemented] Uint32 GetDeviceProperties([IN,optional] string devicePropertyKeys[],[OUT] Win32_PnPDeviceProperty deviceProperties[]);
};

[DYNPROPS]
instance of Win32_PnPEntity
{
	DeviceID = "Crucial";
};</code></pre><p><strong>Note/Credits</strong>: I mostly created these two files by learning from these sources, and then copypasting the examples/defaults values:</p><ul><li>Video: <a class="tc-tiddlylink-external" href="https://youtube.com/watch?v=vAb00RYFThE" rel="noopener noreferrer" target="_blank">Hide your VM using Registry and WMI tricks</a></li><li><a class="tc-tiddlylink-external" href="https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page" rel="noopener noreferrer" target="_blank">Windows Management Instrumentation - Microsoft Learn</a></li></ul><p><strong>Tip</strong>: In the files, when apparently random product/vendor names are mentioned (in this case Acer, Crucial, Phoenix, ...), they don't actually matter. Whatever matters is that, by doing this, any string containing "VMWare" is overwritten with something else, tricking VM detection. You can set whatever you want except VM programs/vendor. The proprietary names included here are for demonstration purposes only and are not strictly needed for this method, all trademark rights belong to the respective owners and not me.</p><p>Finally, in an <strong>administrator</strong> CMD/PowerShell, use <code>mofcomp.exe</code> to apply these files:</p><pre><code>mofcomp .\WMI.mof
mofcomp .\CIMv2.mof</code></pre><p><strong>Note</strong>: This procedure, as far as I understand, essentially corrupts Windows' WMI database. Internal Windows features should still work, and many applications (including SEB, of course) will still work, but some special software that needs to interface with WMI for useful operations might no longer work. Avoid ever using this procedure on a real machine for whatever purpose, only in a VM.</p><h2 class="">Hardening the computer</h2><p>While not necessary to get SEB working, it's a good idea to harden the entire computer in case an examinator wants to do a manual inspection. See <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Harden%2520VM%2520from%2520Human%2520Inspection.html">Harden VM from Human Inspection</a>.</p><h2 class="">VMWare Tools?</h2><p>Installing VMWare tools before applying these patches should not hinder VM detection bypass, seeing SEB's VM detection code. However, I couldn't verify this, as the VMWare Tools installer executable simply doesn't want to start in my VM. I suspect the program fails to start exactly because of the patches, because I only tried to install the Tools after applying everything else. You could be more lucky.</p><h2 class="">No abuse</h2><p>Be careful of only using this information if you actually need to run SEB on Linux or have other issues. Do not abuse the guide to create a VM for doing the exam and then getting out of it mid-session to use the host system normally and cheat. The procedure is not intended for cheating and if we start using it to do that, examiners will push for the holes that allow VM detection bypass to be patched. If we only use it for valid reasons of OS compatibility, likely no one will protest and we will not be forced to use an OS we don't like as host on our computers. If you have to cheat at the written exam then you will fail the oral exam anyways, so study and don't use this method for cheating.
</p></div>










</div></p>
</section>
</body>
</html>

